<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin - Update Products</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 10px;
        background: #1a1a1a; /* dark background same as index */
        color: #f5f5f5;
      }
      h1 {
        text-align: center;
        margin-bottom: 15px;
        color: #ffcc00;
      }
      .controls {
        margin-bottom: 15px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
      }
      input,
      select,
      button {
        padding: 8px;
        border-radius: 4px;
        border: none;
        font-size: 14px;
      }
      input,
      select {
        flex: 1;
        min-width: 150px;
      }
      button {
        background: #ff6600;
        color: #fff;
        cursor: pointer;
      }
      button:hover {
        background: #e65c00;
      }
      .table-wrapper {
        overflow-x: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        background: #2b2b2b;
      }
      th,
      td {
        padding: 8px;
        border: 1px solid #444;
        text-align: left;
        font-size: 14px;
      }
      th {
        background: #333;
        color: #ffcc00;
      }
      .form-section {
        margin-top: 20px;
        background: #2b2b2b;
        padding: 15px;
        border-radius: 8px;
      }
      .form-section h2 {
        margin-top: 0;
        color: #ffcc00;
      }
      .form-row {
        margin-bottom: 12px;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      .form-row label {
        width: 100px;
        font-size: 14px;
      }
      .form-row input {
        flex: 1;
        min-width: 150px;
        padding: 6px;
        border-radius: 4px;
        border: none;
      }
      @media (max-width: 600px) {
        .form-row label {
          width: 100%;
        }
        .form-row input {
          width: 100%;
        }
      }
      /* inside your <style> */
      td:last-child,
      th:last-child {
        position: sticky;
        right: 0;
        background: #333; /* match header style */
        z-index: 2;
      }
      button {
        background: #ff6600;
        color: #fff;
        cursor: pointer;
        border: none;
        border-radius: 4px;
        padding: 6px 10px;
      }
      button:hover {
        background: #e65c00;
      }
      button.delete-btn {
        background: #cc0000;
      }
      button.delete-btn:hover {
        background: #990000;
      }
    </style>
  </head>
  <body>
    <h1>ABS Admin - Manage Products</h1>

    <div class="controls">
      <input type="text" id="searchBox" placeholder="Search products..." />
      <select id="categoryFilter">
        <option value="">All Categories</option>
      </select>
      <button onclick="downloadJSON()">Download</button>
    </div>

    <div class="table-wrapper">
      <table id="productTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Category</th>
            <th>Unit</th>
            <th>MRP</th>
            <th>SALE</th>
            <th>Image</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="form-section" id="formSection">
      <h2 id="formTitle">Add New Product</h2>
      <div class="form-row">
        <label>Name:</label><input type="text" id="prodName" />
      </div>
      <div class="form-row">
        <label>Category:</label><input type="text" id="prodCategory" />
      </div>
      <div class="form-row">
        <label>Unit:</label><input type="text" id="prodUnit" />
      </div>
      <div class="form-row">
        <label>SALE:</label
        ><input type="number" id="prodSale" oninput="updateMRP()" />
      </div>
      <div class="form-row">
        <label>MRP:</label><input type="number" id="prodMrp" readonly />
      </div>
      <div class="form-row">
        <label>Image URL:</label><input type="text" id="prodImg" />
      </div>
      <button onclick="saveProduct()">Save Product</button>
      <button onclick="resetForm()">Cancel</button>
    </div>
    <script src="products.js"></script>
    <script>
      let editId = null;

      function renderTable() {
        const tbody = document.querySelector("#productTable tbody");
        tbody.innerHTML = "";
        const search = document.getElementById("searchBox").value.toLowerCase();
        const filter = document.getElementById("categoryFilter").value;

        products
          .filter(
            (p) =>
              (p.name.toLowerCase().includes(search) || !search) &&
              (p.category === filter || !filter)
          )
          .forEach((p) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
          <td>${p.id}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.unit}</td>
          <td>${p.mrp}</td>
          <td>${p.sale}</td>
          <td><img src="${p.img}" width="40"></td>
          <td>
            <button onclick="editProduct(${p.id})">Edit</button>
  <button class="delete-btn" onclick="deleteProduct(${p.id})">Delete</button>
          </td>
        `;
            tbody.appendChild(tr);
          });

        // Update categories
        const cats = [...new Set(products.map((p) => p.category))];
        const select = document.getElementById("categoryFilter");
        const current = select.value;
        select.innerHTML = `<option value="">All Categories</option>`;
        cats.forEach((c) => {
          const opt = document.createElement("option");
          opt.value = c;
          opt.textContent = c;
          if (c === current) opt.selected = true;
          select.appendChild(opt);
        });
      }

      //   function editProduct(id) {
      //     const p = products.find((x) => x.id === id);
      //     if (!p) return;
      //     editId = id;
      //     document.getElementById("formTitle").innerText = "Edit Product";
      //     document.getElementById("prodName").value = p.name;
      //     document.getElementById("prodCategory").value = p.category;
      //     document.getElementById("prodUnit").value = p.unit;
      //     document.getElementById("prodSale").value = p.sale;
      //     document.getElementById("prodMrp").value = p.mrp;
      //     document.getElementById("prodImg").value = p.img;
      //   }
      function editProduct(id) {
        const p = products.find((x) => x.id === id);
        if (!p) return;
        editId = id;
        document.getElementById("formTitle").innerText = "Edit Product";
        document.getElementById("prodName").value = p.name;
        document.getElementById("prodCategory").value = p.category;
        document.getElementById("prodUnit").value = p.unit;
        document.getElementById("prodSale").value = p.sale;
        document.getElementById("prodMrp").value = p.mrp;
        document.getElementById("prodImg").value = p.img;

        // ðŸ‘‡ This will scroll the page to the form
        document
          .getElementById("formSection")
          .scrollIntoView({ behavior: "smooth" });
      }

      //   function deleteProduct(id) {
      //     products = products.filter((p) => p.id !== id);
      //     renderTable();
      //   }
      function deleteProduct(id) {
        const p = products.find((x) => x.id === id);
        if (!p) return;
        const confirmDelete = confirm(
          `Are you sure you want to delete "${p.name}"?`
        );
        if (!confirmDelete) return;
        products = products.filter((p) => p.id !== id);
        renderTable();
      }

      function saveProduct() {
        const name = document.getElementById("prodName").value.trim();
        const category = document.getElementById("prodCategory").value.trim();
        const unit = document.getElementById("prodUnit").value.trim();
        const sale = parseInt(document.getElementById("prodSale").value);
        if (!name || !category || !unit || !sale) {
          alert("Please fill all fields");
          return;
        }
        const mrp = sale * 10;
        const img = document.getElementById("prodImg").value.trim();

        if (editId) {
          const p = products.find((x) => x.id === editId);
          p.name = name;
          p.category = category;
          p.unit = unit;
          p.sale = sale;
          p.mrp = mrp;
          p.img = img;
        } else {
          const newId = products.length
            ? Math.max(...products.map((p) => p.id)) + 1
            : 1;
          products.push({ id: newId, name, category, unit, sale, mrp, img });
        }
        resetForm();
        renderTable();
      }

      function resetForm() {
        editId = null;
        document.getElementById("formTitle").innerText = "Add New Product";
        document.getElementById("prodName").value = "";
        document.getElementById("prodCategory").value = "";
        document.getElementById("prodUnit").value = "";
        document.getElementById("prodSale").value = "";
        document.getElementById("prodMrp").value = "";
        document.getElementById("prodImg").value = "";
      }

      function updateMRP() {
        const sale = document.getElementById("prodSale").value;
        document.getElementById("prodMrp").value = sale ? sale * 10 : "";
      }

      function downloadJSON() {
        let jsonStr = JSON.stringify(products, null, 2);

        // Remove quotes from keys
        jsonStr = jsonStr.replace(/"([^"]+)":/g, "$1:");

        // Change double quotes around values to single quotes
        jsonStr = jsonStr.replace(/"([^"]*)"/g, "'$1'");

        const blob = new Blob([jsonStr], { type: "application/javascript" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "products.js";
        a.click();
        URL.revokeObjectURL(url);
      }

      document
        .getElementById("searchBox")
        .addEventListener("input", renderTable);
      document
        .getElementById("categoryFilter")
        .addEventListener("change", renderTable);

      renderTable();
    </script>
  </body>
</html>
